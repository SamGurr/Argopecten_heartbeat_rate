------------------------------------------------------------- #
# call the first hour O2 decline
HB.hr.O2.decline <-  HB.first.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the initial hour of O2 DECLINE to 2.0 mg L-1 (every 10 minutes)
HB.hr.O2.decline.RMANOVA.OM <-  na.omit(HB.hr.O2.decline)
HB.first.TWOhours
Argopecten irradians heartbeat measurements in a 2016 experiment at SBU
rm(list=ls()) # remove all data - start fresh
# Install packages if not already in your library-----------------------------------------------------------------------------------------------
require(car) # get the right sums of squares calculations
require(dplyr) # for manipulating our data
require(ggplot2) # for plotting and for our dataset
require(sjstats) # save us time computing key ANOVA stats beyond car
require(broom) # nice for making our results in neat tibbles
require(emmeans) # for marginal means calculations
# Load packages and pacage version/date/import/depends info
library(dplyr) # Version 0.7.6, Packaged: 2018-06-27, Depends: R (>= 3.1.2)Imports: assertthat (>= 0.2.0), bindrcpp (>= 0.2.0.9000), glue (>=1.1.1), magrittr (>= 1.5), methods, pkgconfig (>= 2.0.1), R6(>= 2.2.2), Rcpp (>= 0.12.15), rlang (>= 0.2.0), tibble (>=1.3.1), tidyselect (>= 0.2.3), utils
library(lsmeans) # Version: 2.27-62, Date/Publication: 2018-05-11, Depends: methods, R (>= 3.2)
library(ggpubr)
library(reshape2)
library(broom)
library(mvnormtest)
library(rlang)
library(car)
library(sjstats)
library(CGPfunctions)
library(rstatix)
library(ez)
#set working directory -------------------------------------------------------------- #
setwd("C:/Users/samjg/Documents/Lenovo_2018/MANUSCRIPTS/2016_SBR_Heartrate_Resubmission/HB_data") #set working
# load datasets
HB.first.TWOhours <- read.csv(file="HB_initial_hypoxia.csv", header=T) # first two hours O2 decline and initial hour of hypoxia
HB.24hr.hypoxia <- read.csv(file="24_hr_mean.csv", header=T) # full 24 hour mean data (every 10 minutes)  of O2 <= 2.0 mg L-1
HB.last.TWOhours <- read.csv(file="HB_recovery.csv", header=T) # last two hours of O2 increase and initial hour of recovery to normoxia
# INTIAL  -------------------------------------------------------------- #
# call the first hour O2 decline
HB.hr.O2.decline <-  HB.first.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the initial hour of O2 DECLINE to 2.0 mg L-1 (every 10 minutes)
HB.hr.O2.decline.RMANOVA.OM <-  na.omit(HB.hr.O2.decline)
HB.hr.O2.decline.RMANOVA.OM <-  melt(HB.hr.O2.decline.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.O2.decline.RMANOVA.OM  <- HB.hr.O2.decline.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.O2.decline <- melt(HB.hr.O2.decline, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.O2.decline.2 <- HB.hr.O2.decline %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# call the first hour of hypoxia
HB.hr.initial.hypoxia <- HB.first.TWOhours %>% dplyr::select(Site, hb_sensor, treatment, block, min_70, min_80, min_90, min_100, min_110, min_120) # initial hour of O2 <= 2.0 mg L-1 (every 10 minutes)
HB.hr.initial.hypoxia.RMANOVA.OM <-  na.omit(HB.hr.initial.hypoxia)
HB.hr.initial.hypoxia.RMANOVA.OM <-  melt(HB.hr.initial.hypoxia.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.initial.hypoxia.RMANOVA.OM  <- HB.hr.initial.hypoxia.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.initial.hypoxia <- melt(HB.hr.initial.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.initial.hypoxia.2 <- HB.hr.initial.hypoxia %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# 24 PROLONGED HYPOXIA -------------------------------------------------------------- #
HB.24hr.hypoxia # view data
HB.24hr.hypoxia.OM <-  na.omit(HB.24hr.hypoxia)
HB.24hr.hypoxia.OM <-  melt(HB.24hr.hypoxia.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.24hr.hypoxia.OM  <- HB.24hr.hypoxia.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.24hr.hypoxia.2 <- melt(HB.24hr.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.24hr.hypoxia.2 <- HB.24hr.hypoxia.2 %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# test ####
# Sig diff anovas - Sag Harbor and Fire Island sig diff at hour 1 of hypoxia and Nicoll Bay at hour 2
# Moneyboue and Wuantuck are delayed in diffference between treatment
HB.24hr.hypoxia.ommit<-na.omit(HB.24hr.hypoxia) # ommit NAs
hourly.average <- HB.24hr.hypoxia.ommit %>%  # get the average data for sites
dplyr::select(treatment, variable, Site, value) %>% # call column to summarize
dplyr::filter(variable %in% 'hr_17') # NOTE "hr_9" starts sig diffs for Quantuck and hr_17 start sig diff for MB
hourly.average_MB <- hourly.average %>% filter(Site %in% 'MB') # set above to hour 17
summary(aov(lm(value~treatment, data = hourly.average_MB)))
hourly.average_Q <- hourly.average %>% filter(Site %in% 'Quantuck') # set above to hour 9
summary(aov(lm(value~treatment, data = hourly.average_Q)))
HB.first.TWOhours
# INTIAL  -------------------------------------------------------------- #
# call the first hour O2 decline
HB.hr.O2.decline <-  HB.first.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the initial hour of O2 DECLINE to 2.0 mg L-1 (every 10 minutes)
HB.hr.O2.decline.RMANOVA.OM <-  na.omit(HB.hr.O2.decline)
HB.hr.O2.decline.RMANOVA.OM <-  melt(HB.hr.O2.decline.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.O2.decline.RMANOVA.OM  <- HB.hr.O2.decline.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.O2.decline <- melt(HB.hr.O2.decline, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.O2.decline.2 <- HB.hr.O2.decline %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# call the first hour of hypoxia
HB.hr.initial.hypoxia <- HB.first.TWOhours %>% dplyr::select(Site, hb_sensor, treatment, block, min_70, min_80, min_90, min_100, min_110, min_120) # initial hour of O2 <= 2.0 mg L-1 (every 10 minutes)
HB.hr.initial.hypoxia.RMANOVA.OM <-  na.omit(HB.hr.initial.hypoxia)
HB.hr.initial.hypoxia.RMANOVA.OM <-  melt(HB.hr.initial.hypoxia.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.initial.hypoxia.RMANOVA.OM  <- HB.hr.initial.hypoxia.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.initial.hypoxia <- melt(HB.hr.initial.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.initial.hypoxia.2 <- HB.hr.initial.hypoxia %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
HB.24hr.hypoxia.OM <-  na.omit(HB.24hr.hypoxia)
# 24 PROLONGED HYPOXIA -------------------------------------------------------------- #
HB.24hr.hypoxia # view data
HB.24hr.hypoxia.OM <-  melt(HB.24hr.hypoxia.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.24hr.hypoxia.2 <- melt(HB.24hr.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.24hr.hypoxia.OM  <- HB.24hr.hypoxia.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.24hr.hypoxia.2 <- HB.24hr.hypoxia.2 %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# test ####
# Sig diff anovas - Sag Harbor and Fire Island sig diff at hour 1 of hypoxia and Nicoll Bay at hour 2
# Moneyboue and Wuantuck are delayed in diffference between treatment
HB.24hr.hypoxia.ommit<-na.omit(HB.24hr.hypoxia) # ommit NAs
hourly.average <- HB.24hr.hypoxia.ommit %>%  # get the average data for sites
dplyr::select(treatment, variable, Site, value) %>% # call column to summarize
dplyr::filter(variable %in% 'hr_17') # NOTE "hr_9" starts sig diffs for Quantuck and hr_17 start sig diff for MB
hourly.average_MB <- hourly.average %>% filter(Site %in% 'MB') # set above to hour 17
summary(aov(lm(value~treatment, data = hourly.average_MB)))
hourly.average_Q <- hourly.average %>% filter(Site %in% 'Quantuck') # set above to hour 9
summary(aov(lm(value~treatment, data = hourly.average_Q)))
#####
# RECOVERY -------------------------------------------------------------- #
# call the first hour of hypoxia
HB.hr.O2.increase <- HB.last.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the termination of 24 hour hypoxia; hour of O2 INCREASE to 6.0 mg L-1 (every 10 minutes)
HB.hr.O2.increase.OM <-  na.omit(HB.hr.O2.increase)
HB.hr.O2.increase.OM <-  melt(HB.hr.O2.increase.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.O2.increase.OM  <- HB.hr.O2.increase.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.O2.increase <- melt(HB.hr.O2.increase, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.O2.increase.2 <- HB.hr.O2.increase%>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# call the first hour of hypoxia
HB.hr.recovery.hypoxia <- HB.last.TWOhours %>% dplyr::select(Site, hb_sensor, treatment, block, min_70, min_80, min_90, min_100, min_110, min_120) # initial hour of recovery after 24 hr hypoxia; O2 >= 6.0 mg L-1 (every 10 minutes)
HB.hr.recovery.hypoxia.OM <-  na.omit(HB.hr.recovery.hypoxia)
HB.hr.recovery.hypoxia.OM <-  melt(HB.hr.recovery.hypoxia.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.recovery.hypoxia.OM  <- HB.hr.recovery.hypoxia.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.recovery.hypoxia <- melt(HB.hr.recovery.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.recovery.hypoxia.2 <- HB.hr.recovery.hypoxia%>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# INITIAL RESPONSE TO HYPOXIA - 6 YIMES EVERY 10 MINUTES OVER 1 HOUR
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- paste(HB.hr.initial.hypoxia.RMANOVA.OM$Site,
HB.hr.initial.hypoxia.RMANOVA.OM$hb_sensor, sep ="_")
HB.hr.initial.hypoxia.RMANOVA.OM$treatment <- factor(HB.hr.initial.hypoxia.RMANOVA.OM$treatment)
HB.hr.initial.hypoxia.RMANOVA.OM$Site <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$Site)
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID)
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID)
HB.hr.initial.hypoxia.RMANOVA.OM$variable <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$variable)
HB.hr.initial.hypoxia.RMANOVA.OM$value <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$value)
HB.hr.initial.hypoxia.RMANOVA.OM$treatment <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$treatment)
mod.INITIAL.RMANOVA <- ezANOVA(data=HB.hr.initial.hypoxia.RMANOVA.OM,
dv=value,
wid=.(Subject_ID),
within=.(variable),
between=.(treatment,Site))
print(mod.INITIAL.RMANOVA)
# 24 HOURS OF HYPOXIA - 24 TIMES HOURLY MEANS OVER ONE DAY
HB.24hr.hypoxia.OM$Subject_ID <- paste(HB.24hr.hypoxia.OM$Site,
HB.24hr.hypoxia.OM$hb_sensor, sep ="_")
HB.24hr.hypoxia.OM$Site <- as.factor(HB.24hr.hypoxia.OM$Site)
HB.24hr.hypoxia.OM$Subject_ID <- as.factor(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$Subject_ID <- as.numeric(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$Subject_ID <- abs(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$variable <- as.factor(HB.24hr.hypoxia.OM$variable)
HB.24hr.hypoxia.OM$treatment <- as.factor(HB.24hr.hypoxia.OM$treatment)
HB.24hr.hypoxia.OM$value <- as.factor(HB.24hr.hypoxia.OM$value)
HB.24hr.hypoxia.OM$value <- as.numeric(HB.24hr.hypoxia.OM$value)
#which(is.nan(log(HB.24hr.hypoxia.OM$Subject_ID)))
typeof(HB.24hr.hypoxia.OM$value)
mod.24HOUR.RMANOVA <- ezANOVA(data=HB.24hr.hypoxia.OM,
dv=value,
wid=.(Subject_ID),
within=.(variable),
between=.(treatment,Site))
print(mod.24HOUR.RMANOVA)
?ezANOVA
# ONE HOUR OF RECPOVERY FROM HYPOXIA - 6 YIMES EVERY 10 MINUTES OVER 1 HOUR
HB.hr.recovery.hypoxia.OM$Subject_ID <- paste(HB.hr.recovery.hypoxia.OM$Site,
HB.hr.recovery.hypoxia.OM$hb_sensor, sep ="_")
HB.hr.recovery.hypoxia.OM$Site <- as.factor(HB.hr.recovery.hypoxia.OM$Site)
HB.hr.recovery.hypoxia.OM$Subject_ID <- as.factor(HB.hr.recovery.hypoxia.OM$Subject_ID)
HB.hr.recovery.hypoxia.OM$Subject_ID <- as.numeric(HB.hr.recovery.hypoxia.OM$Subject_ID)
HB.hr.recovery.hypoxia.OM$variable <- as.factor(HB.hr.recovery.hypoxia.OM$variable)
HB.hr.recovery.hypoxia.OM$value <- as.numeric(HB.hr.recovery.hypoxia.OM$value)
HB.hr.recovery.hypoxia.OM$treatment <- factor(HB.hr.recovery.hypoxia.OM$treatment)
HB.hr.recovery.hypoxia.OM$treatment <- as.numeric(HB.hr.recovery.hypoxia.OM$treatment)
mod.RECOVERY.RMANOVA <- ezANOVA(data=HB.hr.recovery.hypoxia.OM,
dv=value,
wid=Subject_ID,
within=variable,
between=.(Site,treatment))
print(mod.RECOVERY.RMANOVA)
# script written by Sam J Gurr
# for MANOVA tests of Argopecten irradians heartbeat measurements in a 2016 experiment at SBU
# INTIAL  -
rm(list=ls()) # remove all data - start fresh
# Install packages if not already in your library-----------------------------------------------------------------------------------------------
require(car) # get the right sums of squares calculations
require(dplyr) # for manipulating our data
require(ggplot2) # for plotting and for our dataset
require(sjstats) # save us time computing key ANOVA stats beyond car
require(broom) # nice for making our results in neat tibbles
require(emmeans) # for marginal means calculations
# Load packages and pacage version/date/import/depends info
library(dplyr) # Version 0.7.6, Packaged: 2018-06-27, Depends: R (>= 3.1.2)Imports: assertthat (>= 0.2.0), bindrcpp (>= 0.2.0.9000), glue (>=1.1.1), magrittr (>= 1.5), methods, pkgconfig (>= 2.0.1), R6(>= 2.2.2), Rcpp (>= 0.12.15), rlang (>= 0.2.0), tibble (>=1.3.1), tidyselect (>= 0.2.3), utils
library(lsmeans) # Version: 2.27-62, Date/Publication: 2018-05-11, Depends: methods, R (>= 3.2)
library(ggpubr)
library(reshape2)
library(broom)
library(mvnormtest)
library(rlang)
library(car)
library(sjstats)
library(CGPfunctions)
library(rstatix)
library(ez)
#set working directory -------------------------------------------------------------- #
setwd("C:/Users/samjg/Documents/My_Projects/Argopecten_hearbeat_rate/Argopecten_heartbeat_rate/RAnalysis/")
# load datasets
HB.first.TWOhours <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/initial_hb_response/Summary_initial_hypoxia_exposure.csv", header=T) # first two hours O2 decline and initial hour of hypoxia
HB.24hr.hypoxia <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/24-hour_hb_response/Summary_24_hour_exposure.csv", header=T) # full 24 hour mean data (every 10 minutes)  of O2 <= 2.0 mg L-1
HB.last.TWOhours <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/recovery_hb_response/Summary_recovery_to_normoxia.csv", header=T) # last two hours of O2 increase and initial hour of recovery to normoxia
------------------------------------------------------------- #
# call the first hour O2 decline
HB.hr.O2.decline <-  HB.first.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the initial hour of O2 DECLINE to 2.0 mg L-1 (every 10 minutes)
HB.hr.O2.decline.RMANOVA.OM <-  na.omit(HB.hr.O2.decline)
HB.hr.O2.decline.RMANOVA.OM <-  melt(HB.hr.O2.decline.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.O2.decline.RMANOVA.OM  <- HB.hr.O2.decline.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.O2.decline <- melt(HB.hr.O2.decline, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.O2.decline.2 <- HB.hr.O2.decline %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# call the first hour of hypoxia
HB.hr.initial.hypoxia <- HB.first.TWOhours %>% dplyr::select(Site, hb_sensor, treatment, block, min_70, min_80, min_90, min_100, min_110, min_120) # initial hour of O2 <= 2.0 mg L-1 (every 10 minutes)
HB.hr.initial.hypoxia.RMANOVA.OM <-  na.omit(HB.hr.initial.hypoxia)
HB.hr.initial.hypoxia.RMANOVA.OM <-  melt(HB.hr.initial.hypoxia.RMANOVA.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.initial.hypoxia.RMANOVA.OM  <- HB.hr.initial.hypoxia.RMANOVA.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.initial.hypoxia <- melt(HB.hr.initial.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.initial.hypoxia.2 <- HB.hr.initial.hypoxia %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# 24 PROLONGED HYPOXIA -------------------------------------------------------------- #
HB.24hr.hypoxia # view data
HB.24hr.hypoxia.OM <-  na.omit(HB.24hr.hypoxia)
HB.24hr.hypoxia.OM <-  melt(HB.24hr.hypoxia.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.24hr.hypoxia.OM  <- HB.24hr.hypoxia.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.24hr.hypoxia.2 <- melt(HB.24hr.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.24hr.hypoxia.2 <- HB.24hr.hypoxia.2 %>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# test ####
# Sig diff anovas - Sag Harbor and Fire Island sig diff at hour 1 of hypoxia and Nicoll Bay at hour 2
# Moneyboue and Wuantuck are delayed in diffference between treatment
HB.24hr.hypoxia.ommit<-na.omit(HB.24hr.hypoxia) # ommit NAs
hourly.average <- HB.24hr.hypoxia.ommit %>%  # get the average data for sites
dplyr::select(treatment, variable, Site, value) %>% # call column to summarize
dplyr::filter(variable %in% 'hr_17') # NOTE "hr_9" starts sig diffs for Quantuck and hr_17 start sig diff for MB
hourly.average_MB <- hourly.average %>% filter(Site %in% 'MB') # set above to hour 17
summary(aov(lm(value~treatment, data = hourly.average_MB)))
hourly.average_Q <- hourly.average %>% filter(Site %in% 'Quantuck') # set above to hour 9
summary(aov(lm(value~treatment, data = hourly.average_Q)))
#####
# RECOVERY -------------------------------------------------------------- #
# call the first hour of hypoxia
HB.hr.O2.increase <- HB.last.TWOhours %>%  dplyr::select(Site, hb_sensor, treatment, block, min_10, min_20, min_30, min_40, min_50, min_60) # data from the termination of 24 hour hypoxia; hour of O2 INCREASE to 6.0 mg L-1 (every 10 minutes)
HB.hr.O2.increase.OM <-  na.omit(HB.hr.O2.increase)
HB.hr.O2.increase.OM <-  melt(HB.hr.O2.increase.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.O2.increase.OM  <- HB.hr.O2.increase.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.O2.increase <- melt(HB.hr.O2.increase, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.O2.increase.2 <- HB.hr.O2.increase%>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
# call the first hour of hypoxia
HB.hr.recovery.hypoxia <- HB.last.TWOhours %>% dplyr::select(Site, hb_sensor, treatment, block, min_70, min_80, min_90, min_100, min_110, min_120) # initial hour of recovery after 24 hr hypoxia; O2 >= 6.0 mg L-1 (every 10 minutes)
HB.hr.recovery.hypoxia.OM <-  na.omit(HB.hr.recovery.hypoxia)
HB.hr.recovery.hypoxia.OM <-  melt(HB.hr.recovery.hypoxia.OM, id.vars=c("Site", "hb_sensor", "treatment", "block"))
HB.hr.recovery.hypoxia.OM  <- HB.hr.recovery.hypoxia.OM  %>% dplyr::select(-block) # ommit sensor and block
HB.hr.recovery.hypoxia <- melt(HB.hr.recovery.hypoxia, id.vars=c("Site", "hb_sensor", "treatment", "block")) # melt into a vertical dataset 'variable' = time; 'value' = heartbeat rate
HB.hr.recovery.hypoxia.2 <- HB.hr.recovery.hypoxia%>% dplyr::select(-hb_sensor, -block) # ommit sensor and block
################################################################################## #
################################################################################## #
# RM ANOVA tests ----------------------------------------------------------- #
##################################################################################
################################################################################## #
# ....response of heartbeat rate with
# one WIHTIN = time (as 'variable' in melted tables)
# two BETWEEN = Site and Treatment
# subject variable  = unique ID as Site_hbsensor
# INITIAL RESPONSE TO HYPOXIA - 6 YIMES EVERY 10 MINUTES OVER 1 HOUR
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- paste(HB.hr.initial.hypoxia.RMANOVA.OM$Site,
HB.hr.initial.hypoxia.RMANOVA.OM$hb_sensor, sep ="_")
HB.hr.initial.hypoxia.RMANOVA.OM$treatment <- factor(HB.hr.initial.hypoxia.RMANOVA.OM$treatment)
HB.hr.initial.hypoxia.RMANOVA.OM$Site <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$Site)
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID)
HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$Subject_ID)
HB.hr.initial.hypoxia.RMANOVA.OM$variable <- as.factor(HB.hr.initial.hypoxia.RMANOVA.OM$variable)
HB.hr.initial.hypoxia.RMANOVA.OM$value <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$value)
HB.hr.initial.hypoxia.RMANOVA.OM$treatment <- as.numeric(HB.hr.initial.hypoxia.RMANOVA.OM$treatment)
mod.INITIAL.RMANOVA <- ezANOVA(data=HB.hr.initial.hypoxia.RMANOVA.OM,
dv=value,
wid=.(Subject_ID),
within=.(variable),
between=.(treatment,Site))
print(mod.INITIAL.RMANOVA)
# 24 HOURS OF HYPOXIA - 24 TIMES HOURLY MEANS OVER ONE DAY
HB.24hr.hypoxia.OM$Subject_ID <- paste(HB.24hr.hypoxia.OM$Site,
HB.24hr.hypoxia.OM$hb_sensor, sep ="_")
HB.24hr.hypoxia.OM$Site <- as.factor(HB.24hr.hypoxia.OM$Site)
HB.24hr.hypoxia.OM$Subject_ID <- as.factor(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$Subject_ID <- as.numeric(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$Subject_ID <- abs(HB.24hr.hypoxia.OM$Subject_ID)
HB.24hr.hypoxia.OM$variable <- as.factor(HB.24hr.hypoxia.OM$variable)
HB.24hr.hypoxia.OM$treatment <- as.factor(HB.24hr.hypoxia.OM$treatment)
HB.24hr.hypoxia.OM$value <- as.factor(HB.24hr.hypoxia.OM$value)
HB.24hr.hypoxia.OM$value <- as.numeric(HB.24hr.hypoxia.OM$value)
#which(is.nan(log(HB.24hr.hypoxia.OM$Subject_ID)))
typeof(HB.24hr.hypoxia.OM$value)
mod.24HOUR.RMANOVA <- ezANOVA(data=HB.24hr.hypoxia.OM,
dv=value,
wid=.(Subject_ID),
within=.(variable),
between=.(treatment,Site))
print(mod.24HOUR.RMANOVA)
?ezANOVA
# ONE HOUR OF RECPOVERY FROM HYPOXIA - 6 YIMES EVERY 10 MINUTES OVER 1 HOUR
HB.hr.recovery.hypoxia.OM$Subject_ID <- paste(HB.hr.recovery.hypoxia.OM$Site,
HB.hr.recovery.hypoxia.OM$hb_sensor, sep ="_")
HB.hr.recovery.hypoxia.OM$Site <- as.factor(HB.hr.recovery.hypoxia.OM$Site)
HB.hr.recovery.hypoxia.OM$Subject_ID <- as.factor(HB.hr.recovery.hypoxia.OM$Subject_ID)
HB.hr.recovery.hypoxia.OM$Subject_ID <- as.numeric(HB.hr.recovery.hypoxia.OM$Subject_ID)
HB.hr.recovery.hypoxia.OM$variable <- as.factor(HB.hr.recovery.hypoxia.OM$variable)
HB.hr.recovery.hypoxia.OM$value <- as.numeric(HB.hr.recovery.hypoxia.OM$value)
HB.hr.recovery.hypoxia.OM$treatment <- factor(HB.hr.recovery.hypoxia.OM$treatment)
HB.hr.recovery.hypoxia.OM$treatment <- as.numeric(HB.hr.recovery.hypoxia.OM$treatment)
mod.RECOVERY.RMANOVA <- ezANOVA(data=HB.hr.recovery.hypoxia.OM,
dv=value,
wid=Subject_ID,
within=variable,
between=.(Site,treatment))
print(mod.RECOVERY.RMANOVA)
LoLinR")
library("lubridate")
library("chron")
library('plyr')
library('dplyr')
library('car')
library('lmtest')
library(ggplot2)        # Version 2.2.1, Packaged: 2016-12-30, Depends: R (>= 3.1)Imports: digest, grid, gtable (>= 0.1.1), MASS, plyr (>= 1.7.1),reshape2, scales (>= 0.4.1), stats, tibble, lazyeval
library(ggpubr)         # Version: 0.1.8 Date: 2018-08-30, Depends: R (>= 3.1.0), ggplot2, magrittrImports: ggrepel, grid, ggsci, stats, utils, tidyr, purrr, dplyr(>=0.7.1), cowplot, ggsignif, scales, gridExtra, glue, polynom
library(Rmisc)          # Version: 1.5 Packaged: 2013-10-21, Depends: lattice, plyr
library(plotrix)        # Version: 3.7-4, Date/Publication: 2018-10-03
# Set Working Directory:
setwd("C:/Users/samjg/Documents/My_Projects/Argopecten_hearbeat_rate/Argopecten_heartbeat_rate/RAnalysis/")
DAT.initial <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/initial_hb_response/Summary_initial_hypoxia_exposure.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.initial)
DAT.recovery <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/recovery_hb_response/Summary_recovery_to_normoxia.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.recovery)
names(DAT.recovery) <- c("site","mesocosm","site_trmt","Treatment","av_HB")
DAT.initial <- DAT.initial %>% select(site,Treatment,av_HB)
DAT.recovery <- DAT.recovery %>% select(site,Treatment,av_HB)
DAT.ALL <- rbind(DAT.initial,DAT.recovery)
################################ #
#subset DAT.initial
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
initial.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('H_first_hour','N_first_hour'))
# just inital hour in H
initial.hour.HYP <-  DAT.ALL %>%
filter(Treatment %in% 'H_first_hour')
# just inital hour in N
initial.hour.NORM <-  DAT.ALL %>%
filter(Treatment %in% 'N_first_hour')
################################ #
#subset DAT.recovery
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
recovery.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('Norm','HYP_post'))
# just inital hour in H
recovery.hour.HYP <-  DAT.ALL %>%
filter(Treatment %in% 'HYP_post')
# just inital hour in N
recovery.hour.NORM <-  DAT.ALL %>%
filter(Treatment %in% 'Norm')
# pre
pre.experiment <-  DAT.ALL %>%
filter(Treatment %in% 'H_pre_trmt_normoxia')
pre.experiment.ANOVA <- summary(aov(av_HB ~ site, data = pre.experiment))
#######################################
# Two way anova between site and hb  ##
DAT.initial <- DAT.initial %>% select(Site,Treatment,av_HB)
DAT.initial
DAT.initial <- DAT.initial %>% select(Site,treatment,av_HB)
DAT.initial
dme file for details
rm(list=ls()) #clears workspace
## install packages if you dont already have them in your library
if ("devtools" %in% rownames(installed.packages()) == 'FALSE') install.packages('devtools')
library(devtools)
if ("segmented" %in% rownames(installed.packages()) == 'FALSE') install.packages('segmented')
if ("plotrix" %in% rownames(installed.packages()) == 'FALSE') install.packages('plotrix')
if ("gridExtra" %in% rownames(installed.packages()) == 'FALSE') install.packages('gridExtra')
if ("LoLinR" %in% rownames(installed.packages()) == 'FALSE') install_github('colin-olito/LoLinR')
if ("lubridate" %in% rownames(installed.packages()) == 'FALSE') install.packages('lubridate')
if ("chron" %in% rownames(installed.packages()) == 'FALSE') install.packages('chron')
if ("plyr" %in% rownames(installed.packages()) == 'FALSE') install.packages('plyr')
if ("dplyr" %in% rownames(installed.packages()) == 'FALSE') install.packages('dplyr')
if ("lmtest" %in% rownames(installed.packages()) == 'FALSE') install.packages('lmtest')
if ("car" %in% rownames(installed.packages()) == 'FALSE') install.packages('car')
#Read in required libraries
##### Include Versions of libraries
#install_github('colin-olito/LoLinR')
library("ggplot2")
library("segmented")
library("plotrix")
library("gridExtra")
library("LoLinR")
library("lubridate")
library("chron")
library('plyr')
library('dplyr')
library('car')
library('lmtest')
library("ggplot2")
library("segmented")
library("plotrix")
library("gridExtra")
library("LoLinR")
library("lubridate")
library("chron")
library('plyr')
library('dplyr')
library('car')
library('lmtest')
library(ggplot2)        # Version 2.2.1, Packaged: 2016-12-30, Depends: R (>= 3.1)Imports: digest, grid, gtable (>= 0.1.1), MASS, plyr (>= 1.7.1),reshape2, scales (>= 0.4.1), stats, tibble, lazyeval
library(ggpubr)         # Version: 0.1.8 Date: 2018-08-30, Depends: R (>= 3.1.0), ggplot2, magrittrImports: ggrepel, grid, ggsci, stats, utils, tidyr, purrr, dplyr(>=0.7.1), cowplot, ggsignif, scales, gridExtra, glue, polynom
library(Rmisc)          # Version: 1.5 Packaged: 2013-10-21, Depends: lattice, plyr
library(plotrix)        # Version: 3.7-4, Date/Publication: 2018-10-03
# Set Working Directory:
setwd("C:/Users/samjg/Documents/My_Projects/Argopecten_hearbeat_rate/Argopecten_heartbeat_rate/RAnalysis/")
DAT.initial <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/initial_hb_response/Summary_initial_hypoxia_exposure_vertical.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.initial)
DAT.recovery <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/recovery_hb_response/Summary_recovery_to_normoxia_vertical.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.recovery)
names(DAT.recovery) <- c("site","mesocosm","site_trmt","Treatment","av_HB")
DAT.initial <- DAT.initial %>% select(Site,treatment,av_HB)
DAT.recovery <- DAT.recovery %>% select(site,Treatment,av_HB)
DAT.ALL <- rbind(DAT.initial,DAT.recovery)
################################ #
#subset DAT.initial
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
initial.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('H_first_hour','N_first_hour'))
# just inital hour in H
initial.hour.HYP <-  DAT.ALL %>%
filter(Treatment %in% 'H_first_hour')
# just inital hour in N
initial.hour.NORM <-  DAT.ALL %>%
filter(Treatment %in% 'N_first_hour')
# Set Working Directory:
setwd("C:/Users/samjg/Documents/My_Projects/Argopecten_hearbeat_rate/Argopecten_heartbeat_rate/RAnalysis/")
DAT.initial <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/initial_hb_response/Summary_initial_hypoxia_exposure_vertical.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.initial)
DAT.recovery <- read.csv(file="Data/Post_insitu_experiment/Heartbeat_data/SUMMARY/recovery_hb_response/Summary_recovery_to_normoxia_vertical.csv", header=T) #read Size.info DAT.initiala # choose 180202_initial_heartbeat_response_for_R
names(DAT.recovery)
names(DAT.recovery) <- c("site","mesocosm","site_trmt","Treatment","av_HB")
DAT.initial <- DAT.initial %>% select(Site,treatment,av_HB)
DAT.recovery <- DAT.recovery %>% select(site,Treatment,av_HB)
DAT.ALL <- rbind(DAT.initial,DAT.recovery)
################################ #
#subset DAT.initial
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
initial.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('H_first_hour','N_first_hour'))
DAT.initial
DAT.initial <- DAT.initial %>% select(site,Treatment,av_HB)
DAT.recovery <- DAT.recovery %>% select(site,Treatment,av_HB)
DAT.ALL <- rbind(DAT.initial,DAT.recovery)
################################ #
#subset DAT.initial
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
initial.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('H_first_hour','N_first_hour'))
# just inital hour in H
initial.hour.HYP <-  DAT.ALL %>%
filter(Treatment %in% 'H_first_hour')
################################ #
#subset DAT.recovery
################################ #
DAT.ALL # view DAT.ALL
# both 1 hour in H and N (initial)
recovery.hour.ALL <- DAT.ALL %>%
filter(Treatment %in% c('Norm','HYP_post'))
# just inital hour in N
initial.hour.NORM <-  DAT.ALL %>%
filter(Treatment %in% 'N_first_hour')
# just inital hour in N
recovery.hour.NORM <-  DAT.ALL %>%
filter(Treatment %in% 'Norm')
# pre
pre.experiment <-  DAT.ALL %>%
filter(Treatment %in% 'H_pre_trmt_normoxia')
pre.experiment.ANOVA <- summary(aov(av_HB ~ site, data = pre.experiment))
shapiro.test(residuals(twoway.anova.model)) # shaprio wilk test of model residuals p = 0.5429;normal distribution
twoway.anova.model <- aov(av_HB ~ Treatment *  site, data = initial.hour.ALL)
hist((residuals(twoway.anova.model)))# histogram of model - looks normal
# just inital hour in H
recovery.hour.HYP <-  DAT.ALL %>%
filter(Treatment %in% 'HYP_post')
plot(fitted(twoway.anova.model),residuals(twoway.anova.model)) # plot residuals
boxplot(residuals(twoway.anova.model)) #plot boxplot of residuals - some outliers present
qqnorm(residuals(twoway.anova.model)) # qqplot - looks normal
TukeyHSD(twoway.anova.model, 'Treatment', conf.level=0.95) # tukey test on the effect of treatment with 95% confidence
summary(twoway.anova.model) # FIVE significant interaction between DAT.initiale and treatment
# FI
FI.initial <- dplyr::filter(initial.hour.ALL, site == "FI")
# X
X.initial <- dplyr::filter(initial.hour.ALL, site == "X")
# NB
NB.initial <- dplyr::filter(initial.hour.ALL, site == "NB")
# MBC
MBC.initial <- dplyr::filter(initial.hour.ALL, site == "MBC")
# Q
Q.initial <- dplyr::filter(initial.hour.ALL, site == "Q")
# ONE-WAY ANOVA######################################################## #
par(mfrow=c(1,3)) #set plotting configuration
par(mar=c(1,1,1,1)) #set margins for plots
FI.ONEWAY <-aov(av_HB ~ Treatment, data = FI.initial)
summary(FI.ONEWAY)
# FI
t.test(av_HB ~ Treatment, data = FI.initial) # t.test 0.01848
hist(residuals(FI.ONEWAY)) #plot histogram of residuals
boxplot(residuals(FI.ONEWAY)) #plot boxplot of residuals
plot(fitted(FI.ONEWAY),residuals(FI.ONEWAY))
qqnorm(residuals(FI.ONEWAY)) # qqplot
